{% extends "base.html" %}
{% load core_extras %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <div>
    <h3 class="mb-1">Agenda do Contrato</h3>
    <div class="text-muted small">
      {{ aluno.dsNome }} · {{ contrato.cdPlano.dsPlano }} · {{ contrato.dtInicioContrato }} a {{ contrato.dtFimContrato }}
    </div>
  </div>
  <a class="btn btn-outline-secondary" href="{% url 'alunos_detail' aluno.id %}">Voltar para ficha</a>
</div>

<div class="card shadow-sm">
  <div class="card-body">
    <div class="alert alert-info">
      Selecione exatamente <strong>{{ aulas_por_semana }}</strong> horarios por semana para travar a agenda durante todo o contrato.
    </div>

    <form method="post">
      {% csrf_token %}
      <div class="alert alert-info">
        Selecione <strong>{{ aulas_por_semana }}</strong> dia(s) e horario(s) por semana.
      </div>
      {% if not horarios_configurados %}
        <div class="alert alert-warning mb-3">
          Nenhum horario do studio cadastrado. Cadastre em <a href="/cadastros/horarios-studio/">Horario do Studio</a>.
        </div>
      {% elif not slot_options %}
        <div class="alert alert-warning mb-3">
          Sem horarios disponiveis com vaga para esse periodo e unidade.
        </div>
      {% endif %}
      <div class="row g-3">
        {% for idx in slot_indices %}
          <div class="col-md-6">
            <div class="border rounded p-3 h-100">
              <div class="fw-semibold mb-2">Aula {{ idx }}</div>
              <div class="row g-2">
                <div class="col-md-7">
                  <label class="form-label">Dia e horario</label>
                  <select class="form-select js-slot-select" name="slot_{{ idx }}" required>
                    <option value="">Selecione</option>
                    {% for slot in slot_options %}
                      <option value="{{ slot.value }}" data-allowed-profs="{{ slot.allowed_profs|join:',' }}">{{ slot.label }}</option>
                    {% endfor %}
                  </select>
                </div>
                <div class="col-md-5">
                  <label class="form-label">Professor</label>
                  <select class="form-select js-prof-select" name="prof_for_{{ idx }}" required>
                    <option value="">Selecione</option>
                    {% for prof in profissionais %}
                      <option value="{{ prof.id }}">{{ prof.profissional }}</option>
                    {% endfor %}
                  </select>
                </div>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
      <div class="d-flex justify-content-end gap-2 mt-3">
        <button class="btn btn-primary" type="submit">Salvar agenda</button>
      </div>
    </form>
  </div>
</div>
{% endblock %}
